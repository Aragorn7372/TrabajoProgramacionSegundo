meta {
  name: Create Pedido
  type: http
  seq: 2
}

post {
  url: {{baseUrl}}/pedidos
  body: json
  auth: bearer
}

auth:bearer {
  token: {{authAdminToken}}
}

body:json {
  {
    "idUsuario": {{targetUserId}},
    "cliente": {
      "nombreCompleto": "Admin Created Pedido",
      "email": "admin.pedido@example.com",
      "telefono": "666000111",
      "direccion": {
        "calle": "Admin St",
        "numero": "99",
        "ciudad": "AdminCity",
        "provincia": "AdminProv",
        "pais": "AdminCountry",
        "codigoPostal": "99999"
      }
    },
    "lineaPedido": [
      {
        "cantidad": 5,
        "idProducto": {{productoId}},
        "precioProducto": 50.0
      }
    ]
  }
}

assert {
  res.status: eq 201
  res.body.id: isDefined
  res.body.cliente.nombreCompleto: eq Admin Created Pedido
}

script:post-response {
  if (res.status === 201) {
      bru.setEnvVar("adminPedidoId", res.body.id);
  }
}
