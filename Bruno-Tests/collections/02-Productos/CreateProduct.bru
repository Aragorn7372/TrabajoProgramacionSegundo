meta {
  name: Create Product
  type: http
  seq: 2
}

post {
  url: {{baseUrl}}/productos
  body: json
  auth: bearer
}

auth:bearer {
  token: {{authAdminToken}}
}

script:pre-request {
  const ts = Date.now();
  bru.setVar("uniqueSuffix", ts);
}

body:json {
  {
    "name": "Producto Test Bruno {{uniqueSuffix}}",
    "price": 99.99,
    "cantidad": 10,
    "category": "{{categoryName}}",
    "image": "default.png",
    "descripcion": "Descripci√≥n del producto de prueba"
  }
}

assert {
  res.status: eq 201
  res.body.name: eq Producto Test Bruno {{uniqueSuffix}}
  res.body.id: isDefined
}

script:post-response {
  if (res.status === 201) {
      bru.setEnvVar("productoId", res.body.id);
      bru.setEnvVar("productoName", res.body.name);
  }
}
